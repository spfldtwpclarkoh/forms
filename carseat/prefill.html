<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Seat Check - Caregiver Pre-fill</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: #000;
            background-color: #f3f4f6;
        }
        .form-container {
            max-width: 8.5in;
            margin: 2rem auto;
        }
        .form-page {
            background-color: white;
            padding: 0.75in;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            border: 1px solid #ccc;
        }
        .form-header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            margin-bottom: 16px;
        }
        .form-header h1 {
            font-size: 18px;
            font-weight: bold;
        }
        .input-field {
            border: none;
            border-bottom: 1px solid #000;
            padding: 2px 0;
            background-color: transparent;
            width: 100%;
            font-size: 12px;
            border-radius: 0;
        }
        .input-field:focus {
            outline: none;
        }
        label {
            font-size: 10px;
            color: #333;
            display: block;
        }
        .flex-grid {
            display: flex;
            gap: 16px;
        }
        #signature-pad-container {
            border: 1px solid #000;
            width: 100%;
            height: 150px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-page">
            <div id="form-content">
                <div class="form-header">
                    <h1>Caregiver Pre-fill Form</h1>
                </div>

                <h2 class="font-bold text-lg mb-2">Caregiver & Vehicle Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><input type="text" id="first-name" class="input-field"><label>First Name</label></div>
                    <div><input type="text" id="last-name" class="input-field"><label>Last Name</label></div>
                    <div class="md:col-span-2"><input type="text" id="address" class="input-field"><label>Address</label></div>
                    <div><input type="text" id="city" class="input-field"><label>City</label></div>
                    <div><input type="text" id="state" class="input-field"><label>State</label></div>
                    <div><input type="text" id="zip" class="input-field"><label>Zip</label></div>
                    <div><input type="text" id="county" class="input-field"><label>County</label></div>
                    <div><input type="text" id="phone" class="input-field"><label>Phone</label></div>
                    <div class="md:col-span-2"><input type="text" id="email" class="input-field"><label>Email Address</label></div>
                    <div><input type="text" id="vehicle-make" class="input-field"><label>Vehicle Make</label></div>
                    <div><input type="text" id="vehicle-model" class="input-field"><label>Model/Trim</label></div>
                    <div><input type="text" id="vehicle-year" class="input-field"><label>Year</label></div>
                </div>

                <h2 class="font-bold text-lg mt-6 mb-2">Agreement & Signature</h2>
                <p class="text-xs my-2 bg-gray-100 p-2 border border-gray-300">
                    I understand and agree that the sole purpose of this program is to help reduce the incidence of improper installation and use of car seats, booster seats
    and seat belts, and that this inspection and demonstration is being provided as a free educational service to me. I realize that the program sponsors
    and certified child passenger safety technicians inspecting the seat(s) cannot fully evaluate the quality, safety, or condition of my car seat, booster seat,
    or the vehicle seat, safety belts, or any component of the vehicle now or in the future. Furthermore, I understand that the actions taken in this program
    will not guarantee my child's safety in a motor vehicle crash. I understand that it is important to read and follow the instruction manuals for both the
    vehicle and the car seat. For these reasons, I hereby release any program participants and any participating organizations or individuals, including the
    site owner, from any present or future liability for any injuries or damages that may result from a vehicle collision or otherwise.
                </p>
                
                <div class="mt-4">
                    <label class="font-bold text-sm">Caregiver Signature:</label>
                    <div id="signature-pad-container" class="mt-1">
                        <canvas id="signature-canvas" class="w-full h-full"></canvas>
                    </div>
                    <div class="text-right mt-1">
                         <button id="clear-signature" class="px-3 py-1 bg-gray-300 rounded text-sm">Clear</button>
                    </div>
                </div>
                
                 <div class="mt-6 text-center">
                    <button id="submit-form" class="px-6 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">Submit Form</button>
                </div>
            </div>
            
            <div id="confirmation-message" class="hidden text-center py-10">
                <h2 class="text-2xl font-bold text-green-600">Submission Successful!</h2>
                <p class="mt-4 text-gray-700">Your information has been submitted. Please notify a technician that you are ready for your car seat check.</p>
            </div>

        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBUL5Jqos4G9uBXJKbMAiZWpxOZLdANR7g",
            authDomain: "stfdcarseat-form.firebaseapp.com",
            projectId: "stfdcarseat-form",
            storageBucket: "stfdcarseat-form.firebasestorage.app",
            messagingSenderId: "850834336483",
            appId: "1:850834336483:web:17061e6c726a2b8b8273d6",
            measurementId: "G-KEMHHLTQKC"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        signInAnonymously(auth).catch((error) => {
            console.error("Anonymous sign-in failed:", error);
        });

        const canvas = document.getElementById('signature-canvas');
        const signaturePadContainer = document.getElementById('signature-pad-container');
        const submitButton = document.getElementById('submit-form');
        const clearButton = document.getElementById('clear-signature');
        let signaturePad;

        function resizeCanvas() {
            const ratio =  Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = signaturePadContainer.offsetWidth * ratio;
            canvas.height = signaturePadContainer.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            if (signaturePad) {
                signaturePad.fromData(signaturePad.toData()); // Redraw signature
            } else {
                signaturePad = new SignaturePad(canvas);
            }
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        clearButton.addEventListener('click', () => {
            signaturePad.clear();
        });

        submitButton.addEventListener('click', async () => {
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            
            if (!firstName || !lastName) {
                alert('Please enter at least a first and last name.');
                return;
            }
            
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';

            const formData = {
                timestamp: new Date(),
                status: 'pending',
                prefillData: {
                    firstName: firstName,
                    lastName: lastName,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    zip: document.getElementById('zip').value,
                    county: document.getElementById('county').value,
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value,
                    vehicleMake: document.getElementById('vehicle-make').value,
                    vehicleModel: document.getElementById('vehicle-model').value,
                    vehicleYear: document.getElementById('vehicle-year').value,
                    signature: signaturePad.isEmpty() ? '' : signaturePad.toDataURL()
                },
                techData: {} // Placeholder for technician data
            };

            try {
                await addDoc(collection(db, "carSeatSubmissions"), formData);
                document.getElementById('form-content').classList.add('hidden');
                document.getElementById('confirmation-message').classList.remove('hidden');
            } catch (error) {
                console.error("Error adding document: ", error);
                alert("There was an error submitting your form. Please try again.");
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Form';
            }
        });
    </script>
</body>
</html>

